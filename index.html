<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpotiVibe - Your Vibetown Radio üìª</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-dark: #0d0d12;
            --bg-card: #151519;
            --bg-card-alt: #1a1a20;
            --candy-pink: #ff5c8d;
            --candy-orange: #ff8c42;
            --candy-yellow: #ffd93d;
            --candy-teal: #14f195;
            --candy-blue: #00d4ff;
            --candy-purple: #9945ff;
            --candy-coral: #ff6b6b;
            --text-primary: #ffffff;
            --text-secondary: #9090a0;
            --text-muted: #606070;
            --border-subtle: rgba(255,255,255,0.06);
            --gradient-candy: linear-gradient(135deg, #ff5c8d, #ff8c42, #ffd93d, #14f195, #00d4ff, #9945ff);
            --gradient-warm: linear-gradient(135deg, #ff5c8d, #ff8c42);
            --gradient-cool: linear-gradient(135deg, #14f195, #00d4ff);
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated background blobs - candy colors */
        .bg-blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.12;
            pointer-events: none;
            z-index: 0;
            animation: float 20s ease-in-out infinite;
        }
        .bg-blob-1 { width: 500px; height: 500px; background: var(--candy-pink); top: -150px; left: -150px; animation-delay: 0s; }
        .bg-blob-2 { width: 400px; height: 400px; background: var(--candy-teal); bottom: 5%; right: -100px; animation-delay: -5s; }
        .bg-blob-3 { width: 450px; height: 450px; background: var(--candy-purple); top: 40%; left: 15%; animation-delay: -10s; }
        .bg-blob-4 { width: 350px; height: 350px; background: var(--candy-yellow); top: 20%; right: 20%; animation-delay: -15s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 20px) scale(0.95); }
            75% { transform: translate(-30px, -20px) scale(1.02); }
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Header with shaka */
        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 8px;
        }

        .shaka {
            font-size: 3rem;
            animation: shaka 2s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes shaka {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(20deg); }
            75% { transform: rotate(-20deg); }
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 700;
            background: var(--gradient-candy);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        .tagline-highlight {
            color: var(--candy-teal);
            font-weight: 600;
        }

        /* Weather badge - always 75¬∞F in Vibetown */
        .vibetown-weather {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            border-radius: 50px;
            padding: 8px 16px;
            margin-top: 16px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .weather-sun {
            animation: spin 10s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .weather-temp {
            color: var(--candy-yellow);
            font-weight: 600;
        }

        /* Search Section */
        .search-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 28px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .search-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-candy);
            background-size: 300% 100%;
            animation: gradientShift 4s ease infinite;
        }

        .search-label {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .search-label-icon {
            font-size: 1.5rem;
            margin-right: 8px;
            vertical-align: middle;
        }

        .search-inner {
            display: flex;
            gap: 16px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .search-input {
            background: var(--bg-card-alt);
            border: 2px solid var(--border-subtle);
            border-radius: 18px;
            padding: 18px 28px;
            font-size: 1.2rem;
            color: var(--text-primary);
            font-family: inherit;
            font-weight: 500;
            width: 220px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--candy-pink);
            box-shadow: 0 0 30px rgba(255,92,141,0.2);
        }

        .search-input::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        .search-btn {
            background: var(--gradient-warm);
            border: none;
            border-radius: 18px;
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 40px rgba(255,92,141,0.35);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .search-btn-icon {
            margin-right: 8px;
        }

        .status-text {
            text-align: center;
            margin-top: 16px;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .error-text { color: var(--candy-coral); }

        /* Results */
        .results {
            display: none;
            animation: fadeSlideIn 0.6s ease;
        }

        .results.active { display: block; }

        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-grid {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 850px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        /* NFT Card */
        .nft-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 28px;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .nft-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .nft-image-wrapper {
            position: relative;
            aspect-ratio: 1;
            background: linear-gradient(135deg, rgba(255,92,141,0.1), rgba(153,69,255,0.1), rgba(20,241,149,0.1));
        }

        .nft-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .nft-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
        }

        .nft-info { padding: 24px; }

        .nft-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 18px;
        }

        .nft-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .share-btn {
            background: #000;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 8px 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .share-btn:hover {
            background: #1a1a1a;
            border-color: #555;
            transform: translateY(-2px);
        }

        .share-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .traits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .trait-item {
            background: var(--bg-card-alt);
            border-radius: 14px;
            padding: 12px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .trait-item:hover {
            border-color: var(--border-subtle);
            transform: translateX(4px);
        }

        .trait-label {
            font-size: 0.6rem;
            color: var(--candy-teal);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .trait-value {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Vibe Card */
        .vibe-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 28px;
            padding: 28px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title-bar {
            width: 24px;
            height: 4px;
            background: var(--gradient-warm);
            border-radius: 2px;
        }

        .vibe-badges {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (max-width: 500px) {
            .vibe-badges { grid-template-columns: 1fr; }
        }

        .vibe-badge {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px 18px;
            background: var(--bg-card-alt);
            border: 1px solid var(--border-subtle);
            border-radius: 18px;
            transition: all 0.3s ease;
            cursor: default;
        }

        .vibe-badge:hover {
            background: rgba(255,255,255,0.04);
            transform: translateX(6px);
            border-color: rgba(255,255,255,0.1);
        }

        .vibe-emoji {
            font-size: 2rem;
            line-height: 1;
        }

        .vibe-info { flex: 1; }

        .vibe-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .vibe-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Reading */
        .reading-box {
            background: linear-gradient(135deg, rgba(255,92,141,0.06), rgba(153,69,255,0.06));
            border: 1px solid rgba(255,92,141,0.15);
            border-radius: 22px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .reading-box::before {
            content: 'üîÆ';
            position: absolute;
            top: -5px;
            right: 20px;
            font-size: 2.5rem;
            opacity: 0.12;
        }

        .reading-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
            color: var(--candy-pink);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .reading-text {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.75;
        }

        /* Genre Section */
        .genre-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 28px;
            padding: 28px;
            position: relative;
            overflow: hidden;
        }

        .radio-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .radio-icon {
            font-size: 2rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .radio-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .radio-subtitle {
            font-size: 0.85rem;
            color: var(--candy-teal);
        }

        .genre-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .genre-primary {
            font-size: 2.8rem;
            font-weight: 700;
            background: var(--gradient-candy);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 6s ease infinite;
        }

        .genre-secondary {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .genre-tag {
            padding: 8px 18px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 500;
            background: var(--bg-card-alt);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .genre-tag:hover {
            background: var(--candy-teal);
            color: var(--bg-dark);
            border-color: var(--candy-teal);
            transform: translateY(-2px);
        }

        .playlist-info {
            background: var(--bg-card-alt);
            border-radius: 18px;
            padding: 20px 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border-subtle);
        }

        .playlist-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .playlist-name {
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .playlist-reason {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .spotify-embed {
            border-radius: 18px;
            overflow: hidden;
        }

        .spotify-embed iframe {
            border-radius: 18px;
        }

        /* Refresh button */
        .refresh-section {
            text-align: center;
            margin-top: 20px;
        }

        .refresh-btn {
            background: transparent;
            border: 2px solid var(--border-subtle);
            border-radius: 14px;
            padding: 12px 24px;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            border-color: var(--candy-teal);
            color: var(--candy-teal);
            transform: translateY(-2px);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 50px 20px 30px;
        }

        .footer-content {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .footer-brand {
            background: var(--gradient-cool);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .footer-shaka {
            font-size: 1.2rem;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            border: 1px solid var(--candy-teal);
            border-radius: 14px;
            padding: 14px 24px;
            color: var(--text-primary);
            font-size: 0.9rem;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(20,241,149,0.2);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="bg-blob bg-blob-1"></div>
    <div class="bg-blob bg-blob-2"></div>
    <div class="bg-blob bg-blob-3"></div>
    <div class="bg-blob bg-blob-4"></div>

    <div class="container">
        <header class="header">
            <div class="header-top">
                <span class="shaka">ü§ô</span>
                <h1 class="logo">SpotiVibe</h1>
                <span class="shaka" style="animation-delay: -1s;">ü§ô</span>
            </div>
            <p class="tagline">Your personal <span class="tagline-highlight">Vibetown Radio Station</span></p>
            <div class="vibetown-weather">
                <span class="weather-sun">‚òÄÔ∏è</span>
                <span>Vibetown Weather:</span>
                <span class="weather-temp">75¬∞F</span>
                <span>Always sunny</span>
            </div>
        </header>

        <div class="search-card">
            <div class="search-label">
                <span class="search-label-icon">üìª</span>
                Tune into your Vibie's frequency
            </div>
            <div class="search-inner">
                <input type="number" id="gvcInput" class="search-input" placeholder="GVC # (1-6969)">
                <button id="searchBtn" class="search-btn">
                    <span class="search-btn-icon">üîÆ</span>Find My Vibes
                </button>
            </div>
            <p id="statusText" class="status-text" style="display: none;"></p>
            <p id="errorText" class="status-text error-text" style="display: none;"></p>
        </div>

        <div id="results" class="results">
            <div class="results-grid">
                <div class="nft-card">
                    <div class="nft-image-wrapper">
                        <img id="nftImage" class="nft-image" style="display: none;" alt="GVC NFT">
                        <div id="nftPlaceholder" class="nft-placeholder">ü§ô</div>
                    </div>
                    <div class="nft-info">
                        <div class="nft-header">
                            <h2 id="nftTitle" class="nft-title"></h2>
                            <button id="shareBtn" class="share-btn" title="Share on X">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                Share
                            </button>
                        </div>
                        <div id="traitsGrid" class="traits-grid"></div>
                    </div>
                </div>

                <div class="vibe-card">
                    <div class="section-title">
                        <span class="section-title-bar"></span>
                        Vibe DNA Analysis
                    </div>
                    <div id="vibeBadges" class="vibe-badges"></div>
                    
                    <div class="reading-box">
                        <div class="reading-header">
                            <span>‚ú®</span>
                            <span>The Vibe Reading</span>
                        </div>
                        <p id="vibeReading" class="reading-text"></p>
                    </div>
                </div>
            </div>

            <div class="genre-card">
                <div class="radio-header">
                    <span class="radio-icon">üìª</span>
                    <div>
                        <div class="radio-title">Now Broadcasting</div>
                        <div class="radio-subtitle">Your Vibetown Radio Station</div>
                    </div>
                </div>

                <div class="genre-display">
                    <span id="genrePrimary" class="genre-primary"></span>
                    <div id="genreSecondary" class="genre-secondary"></div>
                </div>
                
                <div class="playlist-info">
                    <div class="playlist-label">üéµ On Air Now</div>
                    <div id="playlistName" class="playlist-name"></div>
                    <p id="playlistReason" class="playlist-reason"></p>
                </div>

                <div id="spotifyEmbed" class="spotify-embed"></div>

                <div class="refresh-section">
                    <button id="refreshBtn" class="refresh-btn">üîÑ Spin the dial for a new station</button>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <span>Powered by</span>
                <span class="footer-brand">Dorticus Maximus</span>
                <span class="footer-shaka">ü§ô</span>
            </div>
        </footer>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const GVC_CONTRACT = '0xB8Ea78fcaCEf50d41375E44E6814ebbA36Bb33c4';
        const ALCHEMY_API_KEY = '0M49GC5sazH-O5qUtGdKL';

        // VIBE CATEGORIES
        const VIBE_CATEGORIES = {
            fullSend: { name: 'Full Send', emoji: 'üöÄ', color: '#ff5c8d', desc: 'Maximum intensity' },
            allIn: { name: 'All In', emoji: '‚òÄÔ∏è', color: '#ffd93d', desc: 'Bright & committed' },
            zoomIn: { name: 'Zoom In', emoji: '‚ö°', color: '#ff8c42', desc: 'Fast & driven' },
            soChill: { name: 'So Chill', emoji: 'üßä', color: '#00d4ff', desc: 'Relaxed & easy' },
            throwback: { name: 'Throwback', emoji: 'üìº', color: '#9945ff', desc: 'Nostalgic vibes' },
            vibeOut: { name: 'Vibe Out', emoji: 'üåä', color: '#14f195', desc: 'Flowy & dreamy' },
            drip: { name: 'Drip', emoji: 'üíé', color: '#bc3fbc', desc: 'Luxe & premium' }
        };

        // VERIFIED PLAYLIST DATABASE
        const GENRE_PLAYLISTS = {
            'Hip-Hop': [
                { id: '37i9dQZF1DX0XUsuxWHRQd', name: 'RapCaviar' },
                { id: '37i9dQZF1DWY4xHQp97fN6', name: 'Get Turnt' },
                { id: '37i9dQZF1DX2RxBh64BHjQ', name: 'Most Lit' },
                { id: '37i9dQZF1DWT5MrZnPU1zD', name: 'Most Necessary' },
                { id: '37i9dQZF1DX6GwdWRQMQpq', name: 'Gold School' },
                { id: '37i9dQZF1DWTggY0yqBxES', name: 'Mellow Bars' },
                { id: '37i9dQZF1DX7Mq3mO5SThc', name: 'Hip-Hop Controller' },
                { id: '37i9dQZF1DX2sQHbtx0sdt', name: 'Global Hip-Hop' },
                { id: '37i9dQZF1DX48TTZL62Yht', name: 'Hip-Hop Favourites' },
                { id: '37i9dQZF1DWUraJYejk11q', name: 'Get Lit' },
                { id: '37i9dQZF1DX0b0jSm5h5jR', name: 'I Love My 90s Hip-Hop' },
                { id: '37i9dQZF1DX76Wlfdnj7AP', name: 'Beast Mode' }
            ],
            'R&B': [
                { id: '37i9dQZF1DX4SBhb3fqCJd', name: 'Are & Be' },
                { id: '37i9dQZF1DWYmmr74INQlb', name: 'R&B Favourites' },
                { id: '37i9dQZF1DX6VDO8a6cQME', name: 'Chill R&B' },
                { id: '37i9dQZF1DWXnexX7CktaI', name: '90s R&B' },
                { id: '37i9dQZF1DX2UgsUIg75Vg', name: 'Good Vibes' },
                { id: '37i9dQZF1DX7FY5ma9PVot', name: 'Neo Soul' },
                { id: '37i9dQZF1DWTbzY5gOVvKd', name: 'Bedroom Jams' },
                { id: '37i9dQZF1DX4y8h9WqDPAE', name: 'Feelin Good' },
                { id: '37i9dQZF1DX7Jl5KP2eZaS', name: 'New Jack Swing' }
            ],
            'Electronic': [
                { id: '37i9dQZF1DX4dyzvuaRJ0n', name: 'mint' },
                { id: '37i9dQZF1DXa8NOEUWPn9W', name: 'Housewerk' },
                { id: '37i9dQZF1DX1kCIzMYtzum', name: 'Dance Party' },
                { id: '37i9dQZF1DX6J5NfMJS675', name: 'Techno Bunker' },
                { id: '37i9dQZF1DX0hvSv9Rf41p', name: 'Bass Arcade' },
                { id: '37i9dQZF1DXaXB8fQg7xif', name: 'Dance Rising' },
                { id: '37i9dQZF1DX0BcQWzuB7ZO', name: 'Dance Hits' },
                { id: '37i9dQZF1DX5Q27plkaOQ3', name: 'Night Rider' }
            ],
            'Lo-Fi': [
                { id: '37i9dQZF1DWWQRwui0ExPn', name: 'Lofi Beats' },
                { id: '37i9dQZF1DX8Uebhn9wzrS', name: 'Chill Lofi Study' },
                { id: '37i9dQZF1DX3rxVfibe1L0', name: 'Peaceful Meditation' },
                { id: '37i9dQZF1DX4WYpdgoIcn6', name: 'Chill Hits' },
                { id: '37i9dQZF1DX9sIqqvKsjG8', name: 'Deep Focus' },
                { id: '37i9dQZF1DX8NTLI2TtZa6', name: 'Peaceful Piano' }
            ],
            'Rock': [
                { id: '37i9dQZF1DXcF6B6QPhFDv', name: 'Rock This' },
                { id: '37i9dQZF1DWXRqgorJj26U', name: 'Rock Classics' },
                { id: '37i9dQZF1DX1rVvRgjX59F', name: 'Hard Rock' },
                { id: '37i9dQZF1DX9wa6XirBPv8', name: 'Rock Party' },
                { id: '37i9dQZF1DWWJOmJ7nRx0C', name: '00s Rock Anthems' },
                { id: '37i9dQZF1DX4uPi2GIz1pT', name: 'Ultimate Indie Rock' },
                { id: '37i9dQZF1DX5HvXdpOOQtp', name: '70s Rock' }
            ],
            'Jazz': [
                { id: '37i9dQZF1DXbITWG1ZJKYt', name: 'Jazz Classics' },
                { id: '37i9dQZF1DWTR4ZOXTfd9K', name: 'Blue Note' },
                { id: '37i9dQZF1DX4wta20PHgwo', name: 'Late Night Jazz' },
                { id: '37i9dQZF1DX7YCknf2jT6s', name: 'Coffee Shop Jazz' },
                { id: '37i9dQZF1DWVqfgj8NZEp1', name: 'Coffee Table Jazz' },
                { id: '37i9dQZF1DX0SM0LYsmbMT', name: 'Jazz Rap' },
                { id: '37i9dQZF1DX5jkvar30HjL', name: 'Smooth Jazz' }
            ],
            '80s': [
                { id: '37i9dQZF1DX4UtSsGT1Sbe', name: 'All Out 80s' },
                { id: '37i9dQZF1DXb57FjYWz00c', name: '80s Smash Hits' },
                { id: '37i9dQZF1DX1fjrDdvcbOc', name: '80s Hard Rock' },
                { id: '37i9dQZF1DXdLEN7aqioXM', name: 'Synthwave' },
                { id: '37i9dQZF1DWTJ7xPn4vNaz', name: 'All Out 70s' },
                { id: '37i9dQZF1DX1spT6G94GFC', name: '80s Rock Anthems' },
                { id: '37i9dQZF1DX4WELsJtFZjZ', name: 'Soft 80s' }
            ],
            'Funk': [
                { id: '37i9dQZF1DX70TzPK5buVf', name: 'Funk Outta Here' },
                { id: '37i9dQZF1DXaKIA8E7WcJj', name: 'Disco Forever' },
                { id: '37i9dQZF1DX3oHGT11Ov4F', name: 'Nu Disco' },
                { id: '37i9dQZF1DWWvhKV4FBciw', name: 'Funk & Soul Classics' },
                { id: '37i9dQZF1DWTJ7xPn4vNaz', name: 'All Out 70s' }
            ],
            'Pop': [
                { id: '37i9dQZF1DXarRysLJmuju', name: 'Feel Good Pop' },
                { id: '37i9dQZF1DX2A29LI7xHn1', name: 'Pop Sauce' },
                { id: '37i9dQZF1DX4JAvHpjipBk', name: 'New Music Friday' },
                { id: '37i9dQZF1DX7iB3RCnBnN4', name: 'Happy Pop' },
                { id: '37i9dQZF1DXdPec7aLTmlC', name: 'Happy Hits' },
                { id: '37i9dQZF1DX3MU5XUozve7', name: 'Summer Hits' }
            ],
            'Latin': [
                { id: '37i9dQZF1DX10zKzsJ2jva', name: 'Viva Latino' },
                { id: '37i9dQZF1DWY7IeIP1cdjF', name: 'Baila Reggaeton' },
                { id: '37i9dQZF1DX65py6HnnlE1', name: 'Bachata Classics' },
                { id: '37i9dQZF1DX8L1VmOcEBjS', name: 'Best Latin Songs 2025' },
                { id: '37i9dQZF1DXb39rhYOQBVZ', name: 'Viva Latino: Most Streamed' }
            ],
            'Afrobeats': [
                { id: '37i9dQZF1DWYkaDif7Ztbp', name: 'Afrobeats Hits' },
                { id: '37i9dQZF1DWYs2pvwxWA7l', name: 'African Heat' },
                { id: '37i9dQZF1DX7MmacNLmXRO', name: 'Afropop' },
                { id: '37i9dQZF1DXbnzM4wZ6I2M', name: 'Amapiano Lifestyle' }
            ],
            'Indie': [
                { id: '37i9dQZF1DX2Nc3B70tvx0', name: 'Indie All-Stars' },
                { id: '37i9dQZF1DXdbXrPNafg9d', name: 'Indie Pop' },
                { id: '37i9dQZF1DX2sUQwD7tbmL', name: 'Pollen' },
                { id: '37i9dQZF1DX4pbGJDhTXK3', name: 'Lorem' },
                { id: '37i9dQZF1DX6aTaZa0K6VA', name: 'Fresh Finds' }
            ],
            'Reggae': [
                { id: '37i9dQZF1DXbSbnqxMTGx9', name: 'Reggae Classics' },
                { id: '37i9dQZF1DX2oc5aN4UDfD', name: 'Ultimate Reggae' },
                { id: '37i9dQZF1DXan38dNVDdl4', name: 'Island Reggae' },
                { id: '37i9dQZF1DX7HcRDRAqiUf', name: 'Reggae Chillin' }
            ],
            'Metal': [
                { id: '37i9dQZF1DWTcqUzwhNmKv', name: 'Kickass Metal' },
                { id: '37i9dQZF1DX9qNs32fujYe', name: 'Heavy Metal' },
                { id: '37i9dQZF1DX5J7FIl4q56G', name: 'All New Metal' },
                { id: '37i9dQZF1DWWOaP4H0w5b0', name: 'Metal Essentials' },
                { id: '37i9dQZF1DX2LTcinqsO68', name: 'Old School Metal' }
            ],
            'Punk': [
                { id: '37i9dQZF1DXd6tJtr4qeot', name: 'Punk Essentials' },
                { id: '37i9dQZF1DX0KpeLYvWM9r', name: 'Pop Punk Powerhouses' },
                { id: '37i9dQZF1DX3LDIBRoaCDQ', name: 'Skater XL' },
                { id: '37i9dQZF1DX34favBYc9Ch', name: 'Emo Forever' }
            ],
            'Classical': [
                { id: '37i9dQZF1DWWEJlAGA9gs0', name: 'Classical Essentials' },
                { id: '37i9dQZF1DX9G9wwzwWL2k', name: 'Epic Classical' },
                { id: '37i9dQZF1DX561TxkByKxB', name: 'Classical Focus' },
                { id: '37i9dQZF1DX8NTLI2TtZa6', name: 'Peaceful Piano' }
            ],
            'K-Pop': [
                { id: '37i9dQZF1DX9tPFwDMOaN1', name: 'K-Pop ON!' },
                { id: '37i9dQZF1DX4FcAKI5Nhzq', name: 'K-Pop Rising' },
                { id: '37i9dQZF1DWYlzvIAycznp', name: 'Best of K-Pop 2025' },
                { id: '37i9dQZF1DXe5W6diBL5N4', name: 'All New K-Pop' },
                { id: '37i9dQZF1DX4IDaXtVjL83', name: 'K-Pop X-Overs' },
                { id: '37i9dQZF1DX14fiWYoe7Oh', name: 'K-Pop Generations' }
            ],
            'Country': [
                { id: '37i9dQZF1DX1lVhptIYRda', name: 'Hot Country' },
                { id: '37i9dQZF1DX13ZzXoot6Jc', name: 'Country Gold' },
                { id: '37i9dQZF1DWTkxQvqMy4WW', name: 'Nashville Hits' }
            ]
        };

        // TRAIT TO GENRE MAPPING
        const TRAIT_GENRE_MAP = {
            'Mohawk': ['Punk', 'Metal', 'Rock'], 'Leather': ['Rock', 'Metal', 'Punk'],
            'Eyepatch': ['Metal', 'Punk', 'Rock'], 'Knight': ['Metal', 'Classical', 'Rock'],
            'Armor': ['Metal', 'Rock', 'Classical'], 'Spike': ['Punk', 'Metal', 'Rock'],
            'Chain': ['Metal', 'Punk', 'Hip-Hop'], 'Skull': ['Metal', 'Punk', 'Rock'],
            'Hoodie': ['Hip-Hop', 'R&B', 'Lo-Fi'], 'Beanie': ['Hip-Hop', 'Indie', 'Lo-Fi'],
            'Ballcap': ['Hip-Hop', 'Pop', 'Country'], 'Cap': ['Hip-Hop', 'Pop', 'Country'],
            'Tank': ['Hip-Hop', 'Electronic', 'Rock'], 'Jersey': ['Hip-Hop', 'Pop', 'Rock'],
            'Robot': ['Electronic', 'K-Pop', 'Pop'], 'Laser': ['Electronic', 'K-Pop', 'Pop'],
            'Visor': ['Electronic', 'K-Pop', 'Afrobeats'], 'Helmet': ['Electronic', 'Metal', 'Rock'],
            'Neon': ['Electronic', 'K-Pop', '80s'], 'Holographic': ['Electronic', 'K-Pop', 'Pop'],
            'Holo': ['Electronic', 'K-Pop', 'Pop'], 'Cyber': ['Electronic', 'Metal', 'K-Pop'],
            'Gamer': ['Electronic', 'Hip-Hop', 'K-Pop'], 'LED': ['Electronic', 'K-Pop', 'Pop'],
            'Slick': ['R&B', 'Jazz', 'Hip-Hop'], 'Smooth': ['R&B', 'Jazz', 'Lo-Fi'],
            'Suit': ['Jazz', 'R&B', 'Classical'], 'Turtleneck': ['Jazz', 'R&B', 'Indie'],
            'Silk': ['R&B', 'Jazz', 'Pop'], 'Velvet': ['R&B', 'Jazz', 'Funk'],
            'Mullet': ['80s', 'Funk', 'Rock'], 'Afro': ['Funk', 'R&B', 'Afrobeats'],
            'Disco': ['Funk', 'Electronic', '80s'], '80s': ['80s', 'Funk', 'Pop'],
            'Retro': ['80s', 'Funk', 'Indie'], 'Windbreaker': ['80s', 'Funk', 'Hip-Hop'],
            'Boombox': ['80s', 'Funk', 'Hip-Hop'], 'Stache': ['80s', 'Funk', 'Rock'],
            'Synth': ['80s', 'Electronic', 'Indie'], 'Vintage': ['80s', 'Jazz', 'Rock'],
            'Classic': ['80s', 'Jazz', 'Rock'], 'Headband': ['80s', 'Funk', 'Rock'],
            'Mint': ['Lo-Fi', 'Jazz', 'Indie'], 'Calm': ['Lo-Fi', 'Classical', 'Jazz'],
            'Meditation': ['Lo-Fi', 'Classical', 'Jazz'], 'Cream': ['Lo-Fi', 'Jazz', 'R&B'],
            'Seafoam': ['Lo-Fi', 'Indie', 'Electronic'], 'Library': ['Classical', 'Jazz', 'Lo-Fi'],
            'Soft': ['Lo-Fi', 'Indie', 'Classical'], 'Pastel': ['Lo-Fi', 'Indie', 'K-Pop'],
            'Cloud': ['Lo-Fi', 'Indie', 'Electronic'], 'Cozy': ['Lo-Fi', 'Indie', 'Jazz'],
            'Orange': ['Latin', 'Afrobeats', 'Funk'], 'Lime': ['Latin', 'Reggae', 'Afrobeats'],
            'Tropical': ['Reggae', 'Latin', 'Afrobeats'], 'Floral': ['Latin', 'Pop', 'Indie'],
            'Gold': ['R&B', 'Hip-Hop', 'Jazz'], 'Chrome': ['Electronic', 'Hip-Hop', 'K-Pop'],
            'Crown': ['Hip-Hop', 'R&B', 'Classical'], 'Royal': ['Classical', 'R&B', 'Hip-Hop'],
            'Monocle': ['Jazz', 'Classical', 'Indie'], 'Fur': ['R&B', 'Hip-Hop', 'Jazz'],
            'Diamond': ['Hip-Hop', 'R&B', 'Pop'], 'Luxury': ['R&B', 'Jazz', 'Hip-Hop'],
            'Gradient': ['Indie', 'Electronic', 'Lo-Fi'], 'Glass': ['Indie', 'Classical', 'Electronic'],
            'Psychedelic': ['Indie', 'Rock', 'Funk'], 'Cosmic': ['Indie', 'Electronic', 'Lo-Fi'],
            'Space': ['Electronic', 'Indie', 'Lo-Fi'], 'Mystic': ['Indie', 'Electronic', 'Classical'],
            'Bucket': ['Reggae', 'Hip-Hop', 'Indie'], 'Dreads': ['Reggae', 'Afrobeats', 'Hip-Hop'],
            'Island': ['Reggae', 'Latin', 'Afrobeats'], 'Beach': ['Reggae', 'Latin', 'Pop'],
            'Pink': ['K-Pop', 'Pop', 'Electronic'], 'Rainbow': ['K-Pop', 'Pop', 'Indie'],
            'Smile': ['Pop', 'K-Pop', 'Funk'], 'Happy': ['Pop', 'K-Pop', 'Funk'],
            'Heart': ['K-Pop', 'Pop', 'R&B'], 'Sunshine': ['Pop', 'Reggae', 'Funk'],
            'Candy': ['K-Pop', 'Pop', 'Electronic'], 'Flower': ['K-Pop', 'Pop', 'Indie'],
            'Yellow': ['Pop', 'Funk', 'Reggae'], 'Cute': ['K-Pop', 'Pop', 'Indie'],
            'Sparkle': ['K-Pop', 'Pop', 'Electronic'], 'Bright': ['Pop', 'K-Pop', 'Funk'],
            'Jungle': ['Afrobeats', 'Electronic', 'Reggae'], 'Tribal': ['Afrobeats', 'Electronic', 'Reggae'],
            'Cowboy': ['Country', 'Rock', 'Funk'], 'Western': ['Country', 'Rock', 'Funk'],
            'Boots': ['Country', 'Rock', 'Punk'], 'Denim': ['Country', 'Rock', 'Indie'],
            'Flannel': ['Country', 'Indie', 'Rock'], 'Plaid': ['Country', 'Indie', 'Rock'],
            'Grayscale': ['Classical', 'Jazz', 'Lo-Fi'], 'Stone': ['Classical', 'Metal', 'Jazz'],
            'Sculpture': ['Classical', 'Jazz', 'Indie'], 'Marble': ['Classical', 'Jazz', 'Electronic'],
            'Black': ['Hip-Hop', 'Metal', 'Electronic'], 'White': ['Pop', 'Classical', 'K-Pop'],
            'Blue': ['Lo-Fi', 'Jazz', 'Indie'], 'Red': ['Rock', 'Latin', 'Hip-Hop'],
            'Purple': ['Electronic', 'R&B', 'Indie'], 'Green': ['Reggae', 'Indie', 'Lo-Fi']
        };

        // GENRE DESCRIPTIONS - Multiple per genre
        const GENRE_DESCRIPTIONS = {
            'Hip-Hop': [
                "This Vibie carries serious street cred. The swagger is undeniable.",
                "Raw and authentic energy here. Born for the cypher, built for the stage.",
                "There's bars hidden in every pixel. This one knows the culture."
            ],
            'R&B': [
                "Smooth, soulful, dripping with emotion. This Vibie feels every note.",
                "Velvety vibes for days. Made for late-night listening sessions.",
                "Pure rhythm and blues energy. Built for candlelit moments."
            ],
            'Electronic': [
                "Futuristic energy from every pixel. This Vibie belongs on the dance floor.",
                "Running on synthesizers and strobelights. Warehouse-ready.",
                "Digital soul with club-ready frequencies."
            ],
            'Lo-Fi': [
                "Mellow and introspective. Appreciates the quiet moments.",
                "Soft, contemplative quality. Perfect for rainy day reflection.",
                "Built for lazy Sundays and late-night creative flows."
            ],
            'Rock': [
                "Raw power and authentic attitude. Born to rock.",
                "Something rebellious lives here. Guitar riffs mandatory.",
                "Electric energy. Stadium-ready."
            ],
            'Jazz': [
                "Sophisticated and smooth. Impeccable taste.",
                "Timeless elegance. Made for smoky clubs and fine whiskey.",
                "Improvises through life with style and grace."
            ],
            '80s': [
                "Pure synthwave nostalgia. Running on neon and dreams.",
                "Retro energy is immaculate. Straight out of a John Hughes film.",
                "Built for arcade nights and cassette tape vibes."
            ],
            'Funk': [
                "Groovy and timeless. Brings the party wherever they go.",
                "Rhythm in their DNA. Impossible not to move.",
                "Pure boogie energy. Born to make people dance."
            ],
            'Pop': [
                "Bright, fun, universally appealing. Main character energy.",
                "Infectious quality. Built for singalongs.",
                "Pure pop sensibility. Made for the spotlight."
            ],
            'Latin': [
                "Passionate and rhythmic. Fire in their soul.",
                "Unmistakable Latin flavor. The heat is real.",
                "Sabor in every pixel. Knows how to move."
            ],
            'Afrobeats': [
                "Vibrant and energetic. Carrying global rhythms.",
                "Infectious African energy. Impossible to ignore.",
                "Pure sunshine and rhythm. Made for dancing."
            ],
            'Indie': [
                "Unique and artistic. Walks their own path entirely.",
                "Beautifully unconventional. Refreshingly different.",
                "Thoughtful and distinct. Colors outside the lines."
            ],
            'Reggae': [
                "Peaceful and positive. Good vibes only.",
                "One love energy radiates. Stress doesn't live here.",
                "Island spirit is strong. Built for sunset sessions."
            ],
            'Metal': [
                "Intense and powerful. Doesn't hold back. Ever.",
                "Something fierce lives here. Demands to be heard.",
                "Heavy and unapologetic. Battle-ready."
            ],
            'Punk': [
                "Rebellious and authentic. Plays by their own rules.",
                "DIY energy. Doesn't need permission.",
                "Raw, real, refreshingly honest."
            ],
            'Classical': [
                "Refined and timeless. Appreciates the finer things.",
                "Elegance that transcends trends. Truly classic.",
                "Depth is remarkable. Understands true artistry."
            ],
            'K-Pop': [
                "Polished and dynamic. High production energy.",
                "Precision is impressive. Made for the spotlight.",
                "Colorful, energetic, impossibly put-together."
            ],
            'Country': [
                "Down-to-earth and genuine. Knows their roots.",
                "Honest, heartfelt quality. Real as it gets.",
                "Country spirit is strong. Built for open roads."
            ]
        };

        const REASON_TEMPLATES = [
            "Your {vibe1} + {vibe2} combination tuned us to this frequency",
            "The {vibe1} energy mixed with {vibe2} vibes locked this station in",
            "Broadcasting {vibe1} waves with {vibe2} undertones",
            "Your {vibe1}/{vibe2} signal came through loud and clear",
            "Dialed in based on your {vibe1} core and {vibe2} harmonics"
        ];

        let currentNftData = null;
        let currentTokenId = null;

        function parseKeywords(traitValue) {
            return traitValue.replace(/([a-z])([A-Z])/g, '$1 $2').split(/[\s\-_]+/).filter(w => w.length > 1);
        }

        function determineGenre(traits) {
            const genreVotes = {};
            Object.keys(GENRE_PLAYLISTS).forEach(g => genreVotes[g] = 0);
            
            traits.forEach(trait => {
                parseKeywords(trait.value).forEach(keyword => {
                    const genres = TRAIT_GENRE_MAP[keyword];
                    if (genres) {
                        genres.forEach((genre, idx) => {
                            if (genreVotes[genre] !== undefined) genreVotes[genre] += (3 - idx);
                        });
                    }
                });
            });
            
            Object.keys(genreVotes).forEach(genre => { genreVotes[genre] += Math.random() * 1.5; });
            
            const sorted = Object.entries(genreVotes).sort((a, b) => b[1] - a[1]);
            const topGenre = sorted[0][1] > 1 ? sorted[0][0] : Object.keys(GENRE_PLAYLISTS)[Math.floor(Math.random() * Object.keys(GENRE_PLAYLISTS).length)];
            const secondaryGenres = sorted.slice(1, 4).filter(([_, v]) => v > 0.5).map(([g]) => g);
            
            return { primary: topGenre, secondary: secondaryGenres.slice(0, 3) };
        }

        function getRandomPlaylist(genre) {
            const playlists = GENRE_PLAYLISTS[genre];
            if (!playlists || playlists.length === 0) {
                const fallbackGenre = Object.keys(GENRE_PLAYLISTS)[Math.floor(Math.random() * Object.keys(GENRE_PLAYLISTS).length)];
                return GENRE_PLAYLISTS[fallbackGenre][Math.floor(Math.random() * GENRE_PLAYLISTS[fallbackGenre].length)];
            }
            return playlists[Math.floor(Math.random() * playlists.length)];
        }

        function calculateVibes(traits) {
            const KEYWORD_VIBES = {
                'Mohawk': { fullSend: 40, zoomIn: 30 }, 'Leather': { fullSend: 30, drip: 20, throwback: 20 },
                'Red': { fullSend: 35, zoomIn: 20 }, 'Yellow': { allIn: 40, fullSend: 20 },
                'Pink': { allIn: 35, vibeOut: 20 }, 'Rainbow': { allIn: 40, vibeOut: 25 },
                'Smile': { allIn: 45, vibeOut: 15 }, 'Gold': { drip: 45, allIn: 20 },
                'Chrome': { drip: 40, vibeOut: 20 }, 'Suit': { drip: 45, soChill: 20 },
                'Mint': { soChill: 40, vibeOut: 30 }, 'Calm': { soChill: 45, vibeOut: 35 },
                'Mullet': { throwback: 45, fullSend: 20 }, '80s': { throwback: 45, fullSend: 20 },
                'Retro': { throwback: 45, vibeOut: 20 }, 'Robot': { zoomIn: 35, fullSend: 25 },
                'Laser': { zoomIn: 35, fullSend: 30 }, 'Cosmic': { vibeOut: 40, drip: 30 },
                'Glass': { vibeOut: 35, drip: 30 }, 'Holographic': { vibeOut: 35, drip: 35 },
                'Crown': { drip: 45, allIn: 20 }, 'Royal': { drip: 45, throwback: 20 },
                'Hoodie': { fullSend: 20, soChill: 15 }, 'Beanie': { soChill: 20, throwback: 15 },
                'Afro': { throwback: 35, allIn: 20 }, 'Space': { vibeOut: 35, zoomIn: 20 },
                'Meditation': { soChill: 50, vibeOut: 40 }, 'Neon': { zoomIn: 30, fullSend: 25, throwback: 20 },
                'Synth': { throwback: 40, zoomIn: 25 }, 'Disco': { throwback: 40, allIn: 30 }
            };
            
            let scores = { fullSend: 50, allIn: 50, zoomIn: 50, soChill: 50, throwback: 50, vibeOut: 50, drip: 50 };
            
            traits.forEach(trait => {
                parseKeywords(trait.value).forEach(keyword => {
                    const vibes = KEYWORD_VIBES[keyword];
                    if (vibes) Object.keys(vibes).forEach(vibe => { scores[vibe] += vibes[vibe]; });
                });
            });

            Object.keys(scores).forEach(k => { scores[k] = Math.max(10, Math.min(95, scores[k])); });
            return scores;
        }

        function getTopVibes(scores) {
            return Object.entries(scores).sort((a, b) => b[1] - a[1]).slice(0, 4).map(([key]) => key);
        }

        function generateReading(genre, topVibes, traits) {
            const descriptions = GENRE_DESCRIPTIONS[genre] || GENRE_DESCRIPTIONS['Pop'];
            const description = descriptions[Math.floor(Math.random() * descriptions.length)];
            const vibeNames = topVibes.slice(0, 3).map(v => VIBE_CATEGORIES[v].name);
            const allKeywords = traits.flatMap(t => parseKeywords(t.value));
            const colorWords = allKeywords.filter(w => ['Pink', 'Blue', 'Gold', 'Chrome', 'Red', 'Purple', 'Mint', 'Yellow', 'Rainbow', 'Black', 'White', 'Neon', 'Green'].includes(w));
            const color = colorWords[0]?.toLowerCase() || 'unique';
            
            return `${description} With ${vibeNames[0]} as the dominant frequency, supported by ${vibeNames[1]} and ${vibeNames[2]} undertones, the ${color} aesthetic pulls it all together. This is the sound of Vibetown.`;
        }

        function generatePlaylistReason(topVibes) {
            const template = REASON_TEMPLATES[Math.floor(Math.random() * REASON_TEMPLATES.length)];
            return template.replace('{vibe1}', VIBE_CATEGORIES[topVibes[0]].name).replace('{vibe2}', VIBE_CATEGORIES[topVibes[1]].name);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // DOM
        const searchBtn = document.getElementById('searchBtn');
        const gvcInput = document.getElementById('gvcInput');
        const errorText = document.getElementById('errorText');
        const statusText = document.getElementById('statusText');
        const results = document.getElementById('results');
        const shareBtn = document.getElementById('shareBtn');
        const refreshBtn = document.getElementById('refreshBtn');

        gvcInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') searchBtn.click(); });
        searchBtn.addEventListener('click', fetchNFT);
        shareBtn.addEventListener('click', shareVibes);
        refreshBtn.addEventListener('click', refreshPlaylist);

        async function fetchNFT() {
            const id = parseInt(gvcInput.value);
            if (!id || id < 1 || id > 6969) {
                errorText.textContent = 'Enter a valid GVC number (1-6969) ü§ô';
                errorText.style.display = 'block';
                return;
            }

            searchBtn.disabled = true;
            searchBtn.innerHTML = '<span class="search-btn-icon">üì°</span>Tuning in...';
            errorText.style.display = 'none';
            statusText.textContent = 'üìª Scanning frequencies...';
            statusText.style.display = 'block';
            results.classList.remove('active');

            try {
                const url = `https://eth-mainnet.g.alchemy.com/nft/v3/${ALCHEMY_API_KEY}/getNFTMetadata?contractAddress=${GVC_CONTRACT}&tokenId=${id}&refreshCache=false`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                let imageUrl = data.image?.cachedUrl || data.image?.originalUrl || data.image?.pngUrl || data.raw?.metadata?.image || '';
                if (imageUrl.startsWith('ipfs://')) imageUrl = imageUrl.replace('ipfs://', 'https://ipfs.io/ipfs/');

                const traits = data.raw?.metadata?.attributes || [];
                const name = data.name || data.raw?.metadata?.name || `Good Vibes Club #${id}`;

                currentNftData = { name, imageUrl, traits };
                currentTokenId = id;

                statusText.style.display = 'none';
                displayResults(currentNftData, currentTokenId);

            } catch (err) {
                console.error('Fetch error:', err);
                errorText.textContent = 'Couldn\'t tune in. Try again! üìª';
                errorText.style.display = 'block';
                statusText.style.display = 'none';
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<span class="search-btn-icon">üîÆ</span>Find My Vibes';
            }
        }

        function displayResults(nftData, tokenId) {
            const nftImage = document.getElementById('nftImage');
            const nftPlaceholder = document.getElementById('nftPlaceholder');
            
            if (nftData.imageUrl) {
                nftImage.src = nftData.imageUrl;
                nftImage.style.display = 'block';
                nftPlaceholder.style.display = 'none';
                nftImage.onerror = () => { nftImage.style.display = 'none'; nftPlaceholder.style.display = 'flex'; };
            } else {
                nftImage.style.display = 'none';
                nftPlaceholder.style.display = 'flex';
            }

            document.getElementById('nftTitle').textContent = nftData.name;

            const traitsGrid = document.getElementById('traitsGrid');
            traitsGrid.innerHTML = '';
            nftData.traits.forEach(trait => {
                const div = document.createElement('div');
                div.className = 'trait-item';
                div.innerHTML = `<div class="trait-label">${trait.trait_type}</div><div class="trait-value">${trait.value}</div>`;
                traitsGrid.appendChild(div);
            });

            const scores = calculateVibes(nftData.traits);
            const topVibes = getTopVibes(scores);

            const vibeBadges = document.getElementById('vibeBadges');
            vibeBadges.innerHTML = '';
            topVibes.forEach(vibeKey => {
                const vibe = VIBE_CATEGORIES[vibeKey];
                const div = document.createElement('div');
                div.className = 'vibe-badge';
                div.innerHTML = `
                    <div class="vibe-emoji">${vibe.emoji}</div>
                    <div class="vibe-info">
                        <div class="vibe-name" style="color: ${vibe.color}">${vibe.name}</div>
                        <div class="vibe-desc">${vibe.desc}</div>
                    </div>
                `;
                vibeBadges.appendChild(div);
            });

            const { primary: genre, secondary: secondaryGenres } = determineGenre(nftData.traits);
            const playlist = getRandomPlaylist(genre);
            
            // Store all genre options (primary + secondary) so user can switch between them
            allGenreOptions = [genre, ...secondaryGenres];

            document.getElementById('genrePrimary').textContent = genre;
            updateGenreTags(genre);

            document.getElementById('playlistName').textContent = playlist.name;
            document.getElementById('playlistReason').textContent = generatePlaylistReason(topVibes);
            currentPlaylistId = playlist.id;

            const reading = generateReading(genre, topVibes, nftData.traits);
            document.getElementById('vibeReading').textContent = reading;

            document.getElementById('spotifyEmbed').innerHTML = `
                <iframe src="https://open.spotify.com/embed/playlist/${playlist.id}?utm_source=generator&theme=0" 
                    width="100%" height="380" frameBorder="0" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                    loading="lazy"></iframe>
            `;

            results.classList.add('active');
        }

        function refreshPlaylist() {
            if (currentNftData && currentTokenId) {
                const currentGenre = document.getElementById('genrePrimary').textContent;
                const playlist = getRandomPlaylist(currentGenre);
                const scores = calculateVibes(currentNftData.traits);
                const topVibes = getTopVibes(scores);
                
                document.getElementById('playlistName').textContent = playlist.name;
                document.getElementById('playlistReason').textContent = generatePlaylistReason(topVibes);
                currentPlaylistId = playlist.id;
                
                document.getElementById('spotifyEmbed').innerHTML = `
                    <iframe src="https://open.spotify.com/embed/playlist/${playlist.id}?utm_source=generator&theme=0" 
                        width="100%" height="380" frameBorder="0" 
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                `;
                
                showToast('üîÑ New station locked in!');
            }
        }

        function updateGenreTags(currentGenre) {
            const secondaryContainer = document.getElementById('genreSecondary');
            secondaryContainer.innerHTML = '';
            
            // Show all genre options EXCEPT the currently selected one
            allGenreOptions.filter(g => g !== currentGenre).forEach(g => {
                const tag = document.createElement('span');
                tag.className = 'genre-tag';
                tag.textContent = g;
                tag.title = `Switch to ${g}`;
                tag.addEventListener('click', () => switchGenre(g));
                secondaryContainer.appendChild(tag);
            });
        }

        function switchGenre(newGenre) {
            if (!currentNftData) return;
            
            const playlist = getRandomPlaylist(newGenre);
            const scores = calculateVibes(currentNftData.traits);
            const topVibes = getTopVibes(scores);
            
            // Update the display
            document.getElementById('genrePrimary').textContent = newGenre;
            updateGenreTags(newGenre); // Update tags to show other options
            
            document.getElementById('playlistName').textContent = playlist.name;
            document.getElementById('playlistReason').textContent = generatePlaylistReason(topVibes);
            currentPlaylistId = playlist.id;
            
            // Update embed
            document.getElementById('spotifyEmbed').innerHTML = `
                <iframe src="https://open.spotify.com/embed/playlist/${playlist.id}?utm_source=generator&theme=0" 
                    width="100%" height="380" frameBorder="0" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                    loading="lazy"></iframe>
            `;
            
            showToast(`üìª Switched to ${newGenre}!`);
        }

        let currentPlaylistId = null;
        let allGenreOptions = []; // Store all genre options for this Vibie

        function shareVibes() {
            const genre = document.getElementById('genrePrimary').textContent;
            const playlistName = document.getElementById('playlistName').textContent;
            const playlistUrl = `https://open.spotify.com/playlist/${currentPlaylistId}`;
            const gvcUrl = `https://opensea.io/assets/ethereum/${GVC_CONTRACT}/${currentTokenId}`;
            
            const text = `ü§ô GVC #${currentTokenId} is vibing to ${genre}

üéµ Now playing: ${playlistName}
${playlistUrl}

Check out my Vibie üëá
${gvcUrl}

#GoodVibesClub #Vibetown`;
            
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(twitterUrl, '_blank', 'width=550,height=420');
        }
    </script>
</body>
</html>
